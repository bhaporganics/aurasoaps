<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Function Pack | Divine Handmade Soap | Aura</title>
    <meta name="description" content="Experience pure Ayurvedic Function Pack handmade soap from Aura. Natural, organic skincare for radiant, healthy skin. Available in 100g size.">
    <meta name="keywords" content="Function Pack Soap, Ayurvedic Function Pack Soap, handmade Function Pack soap, natural skincare, organic Function Pack soap, Function Pack skincare, natural beauty products, Function Pack for skin">
    <meta name="author" content="Aura, BHAP Organics">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Function Pack | Divine Handmade Soap | Aura">
    <meta property="og:description" content="Natural Ayurvedic Function Pack handmade soap for radiant skin">
    <meta property="og:type" content="product">
    <meta property="og:url" content="https://bhaporganics.github.io/aurasoaps/product-function-pack.html">
    <meta property="og:image" content="https://images.unsplash.com/photo-1608248242905-5f2274e7d4d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80">
    <link rel="canonical" href="https://bhaporganics.github.io/aurasoaps/product-function-pack.html">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="product-detail.css"> 
</head>
<body itemscope itemtype="https://schema.org/Product">
    <header>
        <div class="nav-container">
         
            <a href="index.html" class="logo" itemprop="url">
                <img src="logo-aura.png" alt="Aura Logo" class="logo-img">
                <span itemprop="name">AURA<span></span></span>
            </a>
            
            <div class="nav-links" id="navLinks">
          
              <a href="index.html#home">Home</a>
  
                <a href="index.html#about">About Us</a>
                <a href="index.html#products" class="active">Products</a>
                <a href="index.html#benefits">Benefits</a>
                <a href="index.html#contact">Contact</a>
            </div>
         
        
            <div class="nav-icons-wrapper">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
            
        
                <div class="cart-icon" id="cartIcon">
         
                    <i class="fas fa-shopping-bag"></i>
                    <span class="cart-count">0</span>
                </div>
            </div>
          
          </div>
    </header>

    <button class="mobile-fab" id="mobileFab" style="display:none !important;">
        <i class="fas fa-shopping-bag"></i>
    
    </button>

    <section class="product-hero">
        <div class="container product-hero-container">
            <div class="product-gallery">
                <div class="product-badge">Handmade</div>
                
       
                <div class="slideshow-container" id="slideshowContainer">
                    <div 
                        class="slideshow-slide active" data-index="0">
                        <img src="images/functionpack_soap_2.jpg" 
                
                            alt="Aura Function Pack - Natural Ayurvedic handmade soaps" 
                            itemprop="image"
   
                            loading="lazy">
                    </div>
 
                   
                    <div class="slideshow-slide" data-index="1">
             
                        <img src="images/functionpack_benefits.jpg" 
                    
                            alt="Function Pack ingredients and packaging - Premium Ayurvedic skincare" 
                            itemprop="image"
                     
                        loading="lazy">
          
                   </div>
                    
                    <button class="slideshow-arrow prev" id="slideshowPrev">
                        <i class="fas fa-chevron-left"></i>
    
                 
                    </button>
                    <button class="slideshow-arrow next" id="slideshowNext">
                        <i class="fas fa-chevron-right"></i>
                    </button>
               
             
                       <div class="slideshow-nav" id="slideshowDots">
                        <div class="slideshow-dot active" data-index="0"></div>
                        <div class="slideshow-dot" data-index="1"></div>
                    
                  
                    </div>
                </div>
                
                <div class="product-thumbnails">
                    <div class="thumbnail active" data-image-index="0">
                        <img src="images/functionpack_soap_2.jpg" 
  
                           alt="Function Pack thumbnail" 
                            loading="lazy">
                    </div>
                    
                    <div class="thumbnail" 
                        data-image-index="1">
                        <img src="images/functionpack_benefits.jpg" 
                            alt="Function Pack ingredients thumbnail" 
                
                            loading="lazy">
             
                    </div>
                </div>
            </div>
            
            <div class="product-info">
  
                <h1 itemprop="name">Function Pack: The Mixed Soap Collection</h1>
                <div class="product-subtitle" itemprop="description">Thoughtfully Crafted – Timeless Gifting Traditions</div>
                
                <div class="product-rating" itemprop="aggregateRating" itemscope itemtype="https://schema.org/AggregateRating">
                    <div 
                        class="stars">
                        <i class="fas fa-star"></i>
               
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
       
                         <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
           
                    </div>
                    <div class="rating-text">
   
                         <span itemprop="ratingValue">4.7</span>/5
                    </div>
                </div>
         
                
                <p 
                    class="product-description" itemprop="description">
                    Celebrate life’s special moments with our Function Soap Packs, a beautifully curated set of 6–7 handmade soaps, each in a unique mould design, thoughtfully arranged on a decorative plate. Designed to blend seamlessly with traditional function décor, these packs are perfect for placing on stages, gifting tables, or alongside ceremonial plates during auspicious occasions.
                </p>
                
                <div class="size-display">
                    <h3>Size:</h3>
                    <div class="size-value">100g</div>
                    <div style="font-size: 0.85rem; color: #666; margin-top: 
                        5px;">Perfect for 4-6 weeks of daily use</div>
                </div>
                
                <div class="price-section">
                    <div 
                        class="price-container">
                        
                        <span class="original-price" id="originalPrice">₹1200</span>
                        <span class="current-price" id="currentPrice">₹999</span>
                        
                        <span class="discount-badge" id="discountBadge">17% OFF</span>
                        <span class="price-savings" id="priceSavings">Save ₹201</span>
                  
                    </div>
                    
            
                       <div class="quantity-selector">
                        <div class="quantity-control">
                            <button class="qty-btn" id="decreaseQty">-</button>
  
                            <span class="qty-display" id="quantity">1</span>
    
                            <button class="qty-btn" id="increaseQty">+</button>
                        </div>
                  
                        <div style="font-weight:600;color:var(--secondary);font-size:1rem;">Total: ₹<span id="totalPrice">999</span></div>
     
                       </div>
                    
                    <div class="action-buttons">
                        <button class="btn-primary" id="addToCart">
    
              
                           <i class="fas fa-shopping-bag"></i> Add to Cart
                        </button>
                        <button class="btn-secondary" id="buyNow">
                     
          
                            <i class="fab fa-whatsapp"></i> Buy Now
                        </button>
                    </div>
                </div>
                
  
           
                <div class="features">
                    <div class="feature">
                        <i class="fas fa-shipping-fast"></i>
                        <span>Minimal 
                            Shipping cost</span>
                    </div>
   
                  <div class="feature">
                        <i class="fas fa-award"></i>
                        <span>Ayurvedic</span>
       
                      </div>
            
                </div>
            </div>
        </div>
    </section>

    <section class="section" itemscope itemtype="https://schema.org/ItemList">
        <div class="container">
            <h2 class="section-title">Divinity of the Function Pack</h2>
  
           <p style="text-align:center;max-width:600px;margin:0 auto 30px;font-size:0.9rem;color:#555;">
                Our Function Soap Packs are not just about skincare; they are about honouring traditions, celebrating milestones, and gifting something meaningful that lasts beyond the occasion.</p>
            
            <div class="ingredients-grid">
                <div class="ingredient-card">
                    <div class="ingredient-icon">
                      
                       <i class="fas fa-leaf"></i>
           
                    </div>
                    <h3>A Meaningful Addition to Every Celebration</h3>
                    <p>From baby showers to weddings, housewarmings to festive functions, our soap packs are curated to match the theme, emotion, and 
                        tradition of the occasion. The decorative plate is styled to complement function aesthetics, making it both a gift and a décor element.</p>
                </div>
                
                
                <div class="ingredient-card">
              
                   <div class="ingredient-icon">
                        <i class="fas fa-oil-can"></i>
                    </div>
                
                    <h3>Curated Soap Assortment</h3>
         
                   <p>Each pack contains 6–7 different soap varieties, selected for their gentle cleansing, nourishing properties, and pleasant natural fragrances. Every soap is crafted using skin-friendly ingredients and traditional methods.</p>
                </div>
                
                <div class="ingredient-card">
          
                    <div class="ingredient-icon">
           
                         <i class="fas fa-spa"></i>
                    </div>
                    <h3>Theme-Based Mould Designs</h3>
                    <p>Each soap is poured into custom moulds based on the function, enhancing visual appeal and cultural relevance.</p>
       
                      </div>
                
                <div class="ingredient-card">
                    <div class="ingredient-icon">
                   
                  
                       <i class="fas fa-flask"></i>
                    </div>
                    <h3>Thoughtful Packaging</h3>
                    <p>Every Function Soap Pack is packed by hand with attention to cleanliness, aesthetics, and tradition. From presentation to fragrance, the pack reflects elegance, making it ideal for gifting or ceremonial display.</p>
                
                </div>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <h2 class="section-title">Crafted with 
                Devotion</h2>
            <p style="text-align:center;max-width:600px;margin:0 auto 30px;font-size:0.9rem;color:#555;">
                Each soap is handmade following ancient Ayurvedic principles with modern care.
            </p>
            
            <div class="craftsmanship-grid">
                <div class="craft-step">
                    <div class="step-number">1</div>
                    <h3>Ingredient Selection</h3>
                
 
                    <p>Every soap in the pack is made using carefully chosen natural ingredients, including herbal powders, nourishing oils, and traditional extracts ensuring the soaps are mild, effective, and suitable for all skin types.</p>
                </div>
                
                <div 
                    class="craft-step">
                    <div class="step-number">2</div>
    
                    <h3>Cold Process Method</h3>
                    <p>All soaps are handmade using the cold-process method, allowing nutrients to remain intact while producing a rich, creamy lather. This age-old technique ensures long-lasting, gentle soaps that respect the skin’s natural balance.</p>
                </div>
          
                
                <div class="craft-step">
                    <div class="step-number">3</div>
        
                    <h3>Natural Curing</h3>
                    <p>Each soap is naturally cured for 6 weeks, resulting in a firm, mild bar that cleanses effectively without drying the skin which is perfect for everyday use even after the function.</p>
                </div>
                
     
                   <div class="craft-step">
                    <div class="step-number">4</div>
                    <h3>Decorative Plate Arrangement</h3>
      
                    <p>The soaps are artistically arranged on a function-ready decorative plate, styled to enhance stage presence and traditional settings. The plate can be reused as part of home décor or for future functions.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="section similar-products">
        <div class="container">
            <h2 class="section-title">You May Also Like</h2>
            <p 
   
                 style="text-align:center;max-width:600px;margin:0 auto 30px;font-size:0.9rem;color:#555;">
                Discover more from our divine handmade soap collection
            </p>
            
            <div class="similar-products-grid" id="similarProductsGrid">
                </div>
        
            </div>
    </section>

    <section class="section" style="background:var(--light);">
   
        <div class="container">
            <h2 class="section-title">Customer Love</h2>
            
            <div class="reviews-carousel">
                <div class="swiper">
                    <div class="swiper-wrapper">
 
                 
                        <div class="swiper-slide">
                            <div class="review-card">
                              
                                <div class="review-header">
                              
                                    <div class="review-avatar">
                              
                                        <i class="fas fa-user-circle"></i>
                                    </div>
               
                                    <div>
 
                                        <div class="review-rating">
                                      
                      
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                              
                                            <i class="fas 
                                                fa-star"></i>
                                    
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
        
                                    
                                    </div>
                                        <div style="font-weight:600;color:var(--secondary);font-size:0.95rem;">Swetha Anand</div>
                          
                            
                                    </div>
                                </div>
                                <p class="review-text" style="font-size:0.9rem;">
                        
  
                                    "I've struggled with sensitive skin for years. This soap is a game-changer! No more redness or dryness. My skin feels nourished and smells divine."
                                </p>
                                <div style="font-size:0.8rem;color:#888;margin-top:12px;">
                             
                                    <i class="far fa-clock"></i> 2 months ago
                                </div>
                           
                             </div>
                        </div>
    
                        
                        <div class="swiper-slide">
                      
                           <div class="review-card">
                          
                                <div class="review-header">
                                  
                                    <div class="review-avatar">
                                        <i class="fas fa-user-circle"></i>
              
                                    </div>
     
                                    <div>
                                        <div class="review-rating">
 
                           
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
         
                          
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                 
                 
                                            <i class="fas fa-star-half-alt"></i>
                                        </div>
                               
 
                                        <div style="font-weight:600;color:var(--secondary);font-size:0.95rem;">Mirthin Raj</div>
                                    </div>
                      
                          </div>
                     
                                <p class="review-text" style="font-size:0.9rem;">
                                   
                                    "As someone with combination skin, finding the right soap was tough. This balances everything perfectly! Not too drying, not too oily. The  fragrance is subtle and calming."
                                </p>
                                <div style="font-size:0.8rem;color:#888;margin-top:12px;">
                       
                                    <i class="far fa-clock"></i> 1 month ago
                                </div>
                     
                         </div>
                        </div>
    
                        
                        <div class="swiper-slide">
                
                            <div class="review-card">
                          
                                <div class="review-header">
                            
                                    <div class="review-avatar">
                                        <i class="fas fa-user-circle"></i>
              
                                   
                             </div>
                                    <div>
                                        <div class="review-rating">
 
                     
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
         
                    
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                 
                 
                                            <i class="fas fa-star"></i>
                                        </div>
                         
                      
                                        <div style="font-weight:600;color:var(--secondary);font-size:0.95rem;">Kala Devi</div>
                                    </div>
                
                                 </div>
                     
                                <p class="review-text" style="font-size:0.9rem;">
                                   
                                    "The packaging alone is beautiful! But the product inside is even better. My skin has never felt this soft. I've gifted this to all my friends - they're all converts now!"
                                </p>
                                <div style="font-size:0.8rem;color:#888;margin-top:12px;">
                       
                                    <i class="far fa-clock"></i> 3 weeks ago
                                </div>
                     
                         </div>
                       
                        </div>
                    </div>
                    
     
                       <div class="swiper-button-next" style="color:var(--accent);font-size:1.2rem;"></div>
                    <div class="swiper-button-prev" style="color:var(--accent);font-size:1.2rem;"></div>
               
      
                    <div class="swiper-pagination"></div>
                </div>
   
             </div>
        </div>
    </section>

    <div class="cart-modal" id="cartModal">
        <div class="cart-header">
            <h2>Your Cart</h2>
      
            <button class="close-cart" id="closeCart">
                <i class="fas fa-times"></i>
            </button>
 
        </div>
        
        <div class="min-order-progress" id="minOrderProgress" style="display: none;">
            <div class="progress-header">
                <div class="progress-text">Minimum Order Progress</div>
  
                <div class="progress-count" id="progressCount">0/3</div>
            </div>
         
           <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
            <div class="progress-message" id="progressMessage">
             
                Add 3 more products to place your order
            </div>
  
           </div>
        
        <div class="cart-items" id="cartItems">
            <div class="empty-cart-message" id="emptyCartMessage">
                <p>Your cart is empty</p>
                <p>Add some divine 
                    soaps to get started!</p>
 
            </div>
        </div>
        
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cartTotal">₹0</span>
            </div>
  
    
         
            <div class="cart-actions">
                <button class="whatsapp-order-btn" id="whatsappCartBtn">
                    <i class="fab fa-whatsapp"></i> Order via WhatsApp
                </button>
                <button class="email-order-btn" 
  
                   id="emailCartBtn">
                    <i class="fas fa-envelope"></i> Order via Email
                </button>
            </div>
        </div>
    </div>

    <div class="scrub-modal" id="scrubModal">
        <div class="scrub-modal-content">
  
           <div class="scrub-modal-header">
                <h3 id="scrubProductName">Add to Cart</h3>
                <p>Would you like to add our premium herbal scrub with your soap?</p>
            </div>
            
            <div class="scrub-options">
      
               <div class="scrub-option selected" data-option="soap-only">
                    <div class="scrub-image">
                        <i class="fas fa-soap"></i>
                    </div>
                    
                    <h4>Only Soap </h4>
                    <p>Just the premium Ayurvedic soap</p>
                    <div class="scrub-price" id="soapOnlyPrice">₹0</div>
                </div>
                
                <div class="scrub-option" data-option="with-scrub">
  
                   <div class="scrub-image">
                        <img src="images/soap_scrub.jpg" alt="Herbal scrub pouch">
                    </div>
                    <h4>Soap with Herbal Scrub</h4>
          
                   <p>Enhanced cleansing experience with Rs.20 extra</p>
                    <div class="scrub-price" id="withScrubPrice">₹0</div>
                </div>
            </div>
            
            <div class="scrub-modal-actions">
          
               <button class="scrub-cancel-btn" id="scrubCancelBtn">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="scrub-add-btn" id="scrubAddBtn">
                    <i class="fas fa-shopping-bag"></i> Add to Cart
          
               </button>
            </div>
        </div>
    </div>
    <div class="email-modal" id="emailModal">
        <div class="email-modal-content">
            <div class="email-modal-header">
                <div class="email-icon">
                    <i class="fas fa-envelope"></i>
   
                 </div>
                <h3>Complete Your Order</h3>
                <p>Please provide your name for order confirmation. We'll contact you via email for further details.</p>
            </div>
            
            <div class="email-input-group">
                <label for="customerName">Your Full Name</label>
                <input type="text" id="customerName" class="email-name-input" placeholder="Enter your name" maxlength="50">
            </div>
  
           
            <div class="email-modal-actions">
                <button class="email-cancel-btn" id="emailCancelBtn">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="email-proceed-btn" id="emailProceedBtn" disabled>
 
                   <i class="fas fa-paper-plane"></i> Proceed with Order
                </button>
            </div>
        </div>
    </div>
    <footer id="contact" itemscope itemtype="https://schema.org/LocalBusiness">
        <div class="footer-container">
            <div class="footer-column">
  
     
               <h3>AURA</h3>
                <p itemprop="description">Experience the purity of nature with our handmade organic soaps, crafted with ancient Ayurvedic wisdom and the finest natural ingredients for healthy skin.</p>
            </div>
            
            <div class="footer-column">
          
   
                 <h3>Contact Us</h3>
                <div class="contact-info">
                    <i class="fab fa-whatsapp"></i>
                    <a href="https://wa.me/918532853241" target="_blank">WhatsApp: 8532853241</a>
                </div>
        
              
                <div class="contact-info">
                    <i class="fas fa-envelope"></i>
                    <a href="mailto:bhaporganics@gmail.com" itemprop="email">bhaporganics@gmail.com</a>
                </div>
                
                <div class="contact-info">
                    <i 
                        class="fas fa-map-marker-alt"></i>
                    <span itemprop="address" itemscope itemtype="https://schema.org/PostalAddress">
                        <span itemprop="addressLocality">Theni</span>, 
    
                        <span itemprop="addressRegion">Tamilnadu</span>
                    </span>
     
                </div>
            </div>
            
            <div class="footer-column">
 
                <h3>Quick Links</h3>
                <a href="index.html#home">Home</a>
                <a href="index.html#about">About 
                    Us</a>
                <a href="index.html#products">Products</a>
            
                <a href="index.html#benefits">Benefits</a>
                <a href="index.html#order">Order Options</a>
                <a href="#contact">Contact</a>
            </div>
            
       
                <div class="footer-column">
            
                 <h3>Our Promise</h3>
                <p>100% Natural Ingredients</p>
                <p>Handmade with Care</p>
                <p>Cruelty-Free & Sustainable</p>
                <p>Ayurvedic Formulations</p>
      
                <p>No Artificial 
                    Preservatives</p>
            </div>
        </div>
        
        <div class="copyright">
            <p>&copy;
                AURA - From the House of BHAP Organics. All rights reserved.</p>
        </div>
    </footer>

    <div class="back-to-top" id="backToTop">
        <i class="fas fa-chevron-up"></i>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
    <script src="products-data.js"></script> 
    
    <script>
        // Use the product data from the common file (products-data.js)
        const PRODUCT_ID = 'product-14';
        let productData = allProducts.find(p => p.id === PRODUCT_ID); // Change to let for fallback
        
        // Fallback for robust initialization
        if (!productData) {
            console.error("Product data not found for ID:", PRODUCT_ID);
            // Define fallback product data if not found in the array
            const FALLBACK_PRODUCT = {
                id: PRODUCT_ID,
                name: "Function Pack",
                subtitle: "Occation",
                price: 999,
                mrp: 1200,
                weight: "Differs on moulding",
                size: "Differs on moulding",
                image: "images/functionpack_soap_2.jpg",
                alt: "Aura Rose Petal Handmade Soap - Natural Ayurvedic Soap with Rose Petals for Soft Skin"
            };
            productData = FALLBACK_PRODUCT;
            // Assign fallback data
        }
        
        // Product Configuration
        const productId = productData.id;
        const productName = productData.name;
        const productSubtitle = productData.subtitle || 'Occation';
        const productPrice = productData.price;
        const productMrp = productData.mrp;
        const productWeight = productData.weight || "Differs on moulding";
        const productSize = productData.size || "Differs on moulding";
        const productImage = productData.image;
        const productAlt = productData.alt;
        let quantity = 1;

        // --- New Scrub & Email Modal Variables ---
        const SCRUB_PRICE = 20;
        // Price of the herbal scrub
        const hasScrubOption = true;
        // All single soaps have this option

        // Scrub Modal Elements
        const scrubModal = document.getElementById('scrubModal');
        const scrubProductName = document.getElementById('scrubProductName'); 
        const soapOnlyPrice = document.getElementById('soapOnlyPrice'); 
        const withScrubPrice = document.getElementById('withScrubPrice'); 
        const scrubCancelBtn = document.getElementById('scrubCancelBtn'); 
        const scrubAddBtn = document.getElementById('scrubAddBtn');
        const scrubOptions = document.querySelectorAll('.scrub-option'); 
        let selectedScrubOption = 'soap-only'; 

        // Email Modal Elements
        const emailModal = document.getElementById('emailModal');
        const customerNameInput = document.getElementById('customerName'); 
        const emailCancelBtn = document.getElementById('emailCancelBtn'); 
        const emailProceedBtn = document.getElementById('emailProceedBtn');
        // DOM Elements
        const cartModal = document.getElementById('cartModal');
        const cartIcon = document.getElementById('cartIcon');
        const closeCart = document.getElementById('closeCart');
        const cartItemsContainer = document.getElementById('cartItems');
        const cartTotalElement = document.getElementById('cartTotal');
        const cartCountElement = document.querySelector('.cart-count');
        const emptyCartMessage = document.getElementById('emptyCartMessage');
        const whatsappCartBtn = document.getElementById('whatsappCartBtn');
        const emailCartBtn = document.getElementById('emailCartBtn');
        const mobileFab = document.getElementById('mobileFab');
        const menuToggle = document.getElementById('menuToggle');
        const navLinks = document.getElementById('navLinks');
        // Shared Cart System
        let cart = [];
        const MIN_ORDER_ITEMS = 3; // Used for progress bar and standard soap count equivalence

        // --- Product-Specific Logic (Slideshow and Quantity) ---
        
        // Premium Slideshow Variables
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slideshow-slide');
        let totalSlides = slides.length;
        let slideshowInterval;
        // Initialize Premium Slideshow
        function initSlideshow() {
            const dots = document.querySelectorAll('.slideshow-dot');
            totalSlides = slides.length;
            
            updateSlideshow();
            startSlideshow();
            
            document.getElementById('slideshowPrev').addEventListener('click', () => {
                navigateSlideshow(-1);
            });
            document.getElementById('slideshowNext').addEventListener('click', () => {
                navigateSlideshow(1);
            });
            dots.forEach(dot => {
                dot.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    goToSlide(index);
                });
            });
            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.addEventListener('click', function() {
                    const index = parseInt(this.dataset.imageIndex);
                    goToSlide(index);
                });
            });
            const slideshowContainer = document.getElementById('slideshowContainer');
            slideshowContainer.addEventListener('mouseenter', () => {
                clearInterval(slideshowInterval);
            });
            slideshowContainer.addEventListener('mouseleave', () => {
                startSlideshow();
            });
        }
        
        function startSlideshow() {
            clearInterval(slideshowInterval);
            slideshowInterval = setInterval(() => {
                navigateSlideshow(1);
            }, 4000);
        }
        
        function navigateSlideshow(direction) {
            currentSlide = (currentSlide + direction + totalSlides) % totalSlides;
            updateSlideshow();
        }
        
        function goToSlide(index) {
            currentSlide = index;
            updateSlideshow();
        }
        
        function updateSlideshow() {
            const dots = document.querySelectorAll('.slideshow-dot');
            const thumbnails = document.querySelectorAll('.thumbnail');
            
            slides.forEach((slide, index) => {
                slide.classList.remove('active');
                if (index === currentSlide) {
                    slide.classList.add('active');
                }
            });
            dots.forEach((dot, index) => {
                dot.classList.remove('active');
                if (index === currentSlide) {
                    dot.classList.add('active');
                }
            });
            thumbnails.forEach((thumb, index) => {
                thumb.classList.remove('active');
                if (index === currentSlide) {
                    thumb.classList.add('active');
                }
            });
        }
        
        // Quantity Controls
        document.getElementById('decreaseQty').addEventListener('click', () => {
            if (quantity > 1) {
                quantity--;
                updatePriceDisplay();
            }
        });
        document.getElementById('increaseQty').addEventListener('click', () => {
            if (quantity < 10) {
                quantity++;
                updatePriceDisplay();
            }
        });
        // Update Price Display on Product Page
        function updatePriceDisplay() {
            const total = productPrice * quantity;
            const totalMrp = productMrp * quantity;
            const discountPercent = Math.round(((productMrp - productPrice) / productMrp) * 100);
            const savings = totalMrp - total;
            
            document.getElementById('quantity').textContent = quantity;
            document.getElementById('currentPrice').textContent = `₹${productPrice}`;
            document.getElementById('originalPrice').textContent = `₹${productMrp}`;
            document.getElementById('totalPrice').textContent = total;
            document.getElementById('discountBadge').textContent = `${discountPercent}% OFF`;
            document.getElementById('priceSavings').textContent = `Save ₹${savings}`;
        }
        
        // Add to Cart Functionality - MODIFIED to include Scrub Modal
        document.getElementById('addToCart').addEventListener('click', () => {
            // Check if product has scrub option (All single soaps do)
            if (hasScrubOption) {
                // Show scrub modal and let the modal handle adding to cart
                showScrubModal(productData, quantity);
            } else {
                // Fallback for non-scrub products 
                addToCartWithScrub(productId, quantity, 'soap-only');
            }
        });
        // Buy Now Functionality - Direct WhatsApp
        document.getElementById('buyNow').addEventListener('click', () => {
            const totalPrice = productPrice * quantity;
            const totalMrp = productMrp * quantity;
            const savings = totalMrp - totalPrice;
            const discountPercent = Math.round((savings / totalMrp) * 100);
           
           
            const message = `Hello, I would like to buy ${quantity} × ${productName} Soap (${productWeight}) for ₹${totalPrice}. 
Original Price: ₹${totalMrp}
Discount: ${discountPercent}% OFF
You Save: ₹${savings}

Please confirm my order and provide delivery details.`;
            
            const whatsappUrl = `https://wa.me/918532853241?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        });
        // --- New Function: Show Scrub Modal ---
        function showScrubModal(product, qty) {
            selectedScrubOption = 'soap-only';
            const basePrice = product.price * qty;
            const scrubPriceTotal = (product.price + SCRUB_PRICE) * qty;
            
            scrubProductName.textContent = `Add ${product.name} to Cart`;
            soapOnlyPrice.textContent = `₹${basePrice}`; 
            withScrubPrice.textContent = `₹${scrubPriceTotal}`; 
            
            // Reset selection appearance
            scrubOptions.forEach(option => {
                option.classList.remove('selected'); 
                if (option.dataset.option === 'soap-only') {
                    option.classList.add('selected'); 
                }
            });
            // Show modal
            scrubModal.classList.add('open'); 
            document.body.style.overflow = 'hidden';
        }

        // --- Common Cart Logic (Copied/Adapted from script.js) ---

        // RENAME: The old 'addToCart' function becomes 'addToCartWithScrub'
        function addToCartWithScrub(id, qty, scrubOption) {
            if (qty <= 0) return;
            const product = allProducts.find(p => p.id === id); 
            const existingItem = cart.find(item => 
                item.id === id && item.scrubOption === scrubOption 
            );
            // Calculate final price 
            let finalPrice = product.price;
            let finalMrp = product.mrp;
            if (scrubOption === 'with-scrub') {
                finalPrice += SCRUB_PRICE;
                finalMrp += SCRUB_PRICE; 
            }
            
            if (existingItem) {
                existingItem.quantity += qty;
            } else {
                cart.push({
                    ...product,
                    price: finalPrice,
                    mrp: finalMrp,
                    quantity: qty,
                    scrubOption: scrubOption,
                    originalPrice: product.price,
                    originalMrp: product.mrp 
                });
            }
            
            // Reset product page quantity ONLY if it's the current product being viewed
            if (id === PRODUCT_ID) {
                quantity = 1;
                updatePriceDisplay(); 
            }

            saveCartToStorage(); 
            updateCart();
            const scrubText = scrubOption === 'with-scrub' ? ' with herbal scrub' : ''; 
            showNotification(`${qty} × ${product.name}${scrubText} added to cart!`);
        }


        function loadCartFromStorage() {
            const savedCart = sessionStorage.getItem('auraCleanseCart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
            } else {
                cart = [];
            }
            updateCart();
        }

        function saveCartToStorage() {
            sessionStorage.setItem('auraCleanseCart', JSON.stringify(cart));
            sessionStorage.setItem('auraCleanseCartTimestamp', Date.now());
            try {
                localStorage.setItem('cartUpdated', Date.now().toString());
            } catch (e) {
                console.log("Local storage notification failed");
            }
        }
        
        function getTotalItemsInCart() {
            return cart.reduce((total, item) => total + item.quantity, 0);
        }

        // --- MODIFIED FUNCTION for Requirement 1 ---
        function isMinimumOrderMet() {
            let standardSoapQuantity = 0;
            let functionalPackQuantity = 0;
            
            cart.forEach(item => {
                // 'product-14' is the ID for "Function Pack"
                if (item.id === 'product-14') {
                    functionalPackQuantity += item.quantity;
                } else {
                    // Assuming all other products are standard soaps
                    standardSoapQuantity += item.quantity;
                }
            });

            // Order is satisfied if: (Any 3 standard soaps) OR (Any one functional pack)
            return (standardSoapQuantity >= 3) || (functionalPackQuantity >= 1);
        }

        function updateCart() {
            const totalItems = getTotalItemsInCart();
            cartCountElement.textContent = totalItems;
            
            cartItemsContainer.innerHTML = '';
            
            if (cart.length === 0) {
                emptyCartMessage.style.display = 'block';
                cartItemsContainer.appendChild(emptyCartMessage);
            } else {
                emptyCartMessage.style.display = 'none';
                let totalPrice = 0;
                let totalMrp = 0;
                
                cart.forEach(item => {
                    totalPrice += item.price * item.quantity;
                    totalMrp += item.mrp * item.quantity;
                    
                    const cartItem 
                        = document.createElement('div');
                    cartItem.className = 'cart-item';
                    
                    const scrubIndicator = item.scrubOption === 'with-scrub' ? 
                        '<span class="scrub-indicator">+ Scrub</span>' : '';

                    cartItem.innerHTML = `
                        <div class="cart-item-image">
                            <img src="${item.image || 'soap.jpg'}" alt="${item.alt || item.name}" loading="lazy">
                        </div>
                        <div class="cart-item-details">
                            <div class="cart-item-title">${item.name} ${item.weight ? '(' + item.weight + ')' : ''}${scrubIndicator}</div>
                            <div class="cart-item-price">
                                ₹${item.price} × ${item.quantity} = ₹${item.price * item.quantity}
                                <div style="font-size: 0.8rem;
                                color: #999; text-decoration: line-through;">MRP: ₹${item.mrp * item.quantity}</div>
                            </div>
                        </div>
                        <div class="cart-item-actions">
                            <button class="cart-quantity-btn decrease-cart" data-id="${item.id}" data-scrub="${item.scrubOption || 'soap-only'}">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="cart-item-quantity">${item.quantity}</span>
                            <button class="cart-quantity-btn increase-cart" data-id="${item.id}" data-scrub="${item.scrubOption || 'soap-only'}">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="remove-item" data-id="${item.id}" data-scrub="${item.scrubOption || 'soap-only'}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    cartItemsContainer.appendChild(cartItem);
                });
                
                // Event listeners for cart item 
                // buttons
                document.querySelectorAll('.decrease-cart').forEach(button => {
                    button.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        const scrubOption = this.getAttribute('data-scrub');
                        updateCartQuantity(id, scrubOption, -1);
                    });
                });
                
                document.querySelectorAll('.increase-cart').forEach(button => {
                    button.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        const scrubOption = this.getAttribute('data-scrub');
                        updateCartQuantity(id, scrubOption, 1);
                    });
                });
                
                document.querySelectorAll('.remove-item').forEach(button => {
                    button.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        const scrubOption = this.getAttribute('data-scrub');
                        removeFromCart(id, scrubOption);
                    });
                });
                const totalSavings = totalMrp - totalPrice;
                cartTotalElement.innerHTML = `
                    <div>Total: ₹${totalPrice}</div>
                    <div style="font-size: 0.9rem; color: #27ae60; font-weight: normal;">
                        You save: ₹${totalSavings}
                    </div>
                `;
            }

            updateMinimumOrderUI();
        }

        function updateCartQuantity(productId, scrubOption, change) {
            const item = cart.find(item => 
                item.id === productId && item.scrubOption === scrubOption
            );
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    cart = cart.filter(item => 
                        !(item.id === productId && item.scrubOption === scrubOption)
                    );
                }
                updateCart();
                saveCartToStorage();
                updateMinimumOrderUI();
            }
        }

        function removeFromCart(productId, scrubOption) {
            cart = cart.filter(item => 
                !(item.id === productId && item.scrubOption === scrubOption)
            );
            updateCart();
            saveCartToStorage();
            updateMinimumOrderUI();
            showNotification('Item removed from cart');
        }

        function checkoutViaWhatsApp() {
            if (!isMinimumOrderMet()) {
                showNotification(`Minimum order not met. Add 3 soaps or 1 Function Pack.`);
                return;
            }
            
            let message = "Hello, I would like to place an order from Aura :\n\n";
            let total = 0;
            let totalMrp = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                const itemMrp = item.mrp * item.quantity;
                const sizeInfo = item.weight ? `(${item.weight})` : `(${item.size || '100g'})`;
                const scrubInfo = item.scrubOption === 'with-scrub' ? 
                    ' + Herbal Scrub' : '';
                message += `${item.name}${scrubInfo} ${sizeInfo}: ${item.quantity} × ₹${item.price} = ₹${itemTotal}\n`;
                total += itemTotal;
                totalMrp += itemMrp;
            });
            const savings = totalMrp - total;
            const discountPercent = Math.round((savings / totalMrp) * 100);
            
            message += `\nTotal: ₹${total}`;
            message += `\nTotal Savings: ₹${savings} (${discountPercent}% OFF)`;
            message += `\n\nPlease confirm my order and provide delivery details.`;
            const whatsappUrl = `https://wa.me/918532853241?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // MODIFIED checkoutViaEmail function (now shows modal)
        function checkoutViaEmail() {
            if (!isMinimumOrderMet()) {
                showNotification(`Minimum order not met. Add 3 soaps or 1 Function Pack.`);
                return;
            }
            
            // Proceed to Email modal for name input
            emailModal.classList.add('open');
            document.body.style.overflow = 'hidden';
            customerNameInput.focus();
        }

        // NEW FUNCTION: Complete email order with customer name
        function completeEmailOrder(customerName) {
            if (!customerName || customerName.trim() === '') {
                showNotification('Please enter your name to proceed with the order.');
                return;
            }
            
            // Build the email body
            let emailBody = `Hello Aura Team,\n\n`;
            emailBody += `I would like to place an order from your website.\n\n`;
            emailBody += `Customer Details:\n`;
            emailBody += `- Name: ${customerName}\n`;
            
            emailBody += `\nOrder Details:\n`;
            let total = 0;
            let totalMrp = 0;
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                const itemMrp = item.mrp * item.quantity;
                const sizeInfo = item.weight ? `(${item.weight})` : `(${item.size || '100g'})`;
                const scrubInfo = item.scrubOption === 'with-scrub' ? ' + Herbal Scrub' : '';
                emailBody += `- ${item.name}${scrubInfo} ${sizeInfo}: ${item.quantity} × ₹${item.price} = ₹${itemTotal}\n`;
                total += itemTotal;
                totalMrp += itemMrp;
            });
            const savings = totalMrp - total;
            emailBody += `\nOrder Total: ₹${total}`;
            emailBody += `\nTotal Savings: ₹${savings}`;
            emailBody += `\n\nPlease confirm my order and provide payment/delivery details.`;
            emailBody += `\n\nThank you,\n${customerName}`;
            // Create the mailto link 
            const subject = `Aura-Order - ${new Date().toLocaleDateString()}`;
            const mailtoLink = `mailto:bhaporganics@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(emailBody)}`;
            
            // Close modal and open email client
            emailModal.classList.remove('open');
            document.body.style.overflow = '';
            customerNameInput.value = '';
            emailProceedBtn.disabled = true;
            
            // R2: Clean hash for internal closure
            cleanupHash(emailModal.id); 
            
            // Open the user's email client
            setTimeout(() => {
                window.location.href = mailtoLink;
            }, 300);
        }

        // --- MODIFIED updateMinimumOrderUI FUNCTION ---
        function updateMinimumOrderUI() {
            // 1. Calculate equivalent count for progress bar UI
            let equivalentOrderCount = 0;
            cart.forEach(item => {
                if (item.id === 'product-14') {
                    // Treat 1 Function Pack as 3 items for minimum order tracking
                    equivalentOrderCount += item.quantity * MIN_ORDER_ITEMS;
                } else {
                    // Standard soap count
                    equivalentOrderCount += item.quantity;
                }
            });

            // We keep getTotalItemsInCart() for the cart count bubble, but use the equivalent for progress UI
            const totalItemsInCartBubble = getTotalItemsInCart(); 
            const meetsMinimumOrder = isMinimumOrderMet();
            const minOrderProgress = document.getElementById('minOrderProgress');
            const progressBar = document.getElementById('progressBar');
            const progressCount = document.getElementById('progressCount');
            const progressMessage = document.getElementById('progressMessage');
            
            // Use the equivalent count for progress UI
            const progressBaseCount = Math.min(equivalentOrderCount, MIN_ORDER_ITEMS); // Cap the count displayed to 3
            const progressPercentage = Math.min((equivalentOrderCount / MIN_ORDER_ITEMS) * 100, 100);

            // Hide/show progress bar section 
            if (minOrderProgress) {
                if (totalItemsInCartBubble > 0) {
                    minOrderProgress.style.display = 'block';
                } else {
                    minOrderProgress.style.display = 'none';
                }
            }

            // Update progress bar and count display
            if (progressBar) progressBar.style.width = `${progressPercentage}%`;
            if (progressCount) progressCount.textContent = `${progressBaseCount}/${MIN_ORDER_ITEMS}`; 
            
            if (progressMessage) {
                if (meetsMinimumOrder) { 
                     progressMessage.textContent = '✓ Minimum order requirement met!';
                     progressMessage.className = 'progress-message progress-complete';
                } else if (progressBaseCount === 0) {
                    progressMessage.textContent = `Add ${MIN_ORDER_ITEMS} products (or 1 Functional Pack) to place your order`;
                    progressMessage.className = 'progress-message';
                } else {
                    const itemsNeeded = MIN_ORDER_ITEMS - progressBaseCount;
                    progressMessage.textContent = `Add ${itemsNeeded} more product${itemsNeeded > 1 ? 's' : ''} (or 1 Functional Pack) to place your order`;
                    progressMessage.className = 'progress-message';
                }
            }
            
            // 2. Fix button enabling/disabling and event listeners
            const checkoutButtons = [whatsappCartBtn, emailCartBtn];
            const isCartReady = meetsMinimumOrder;

            checkoutButtons.forEach(btn => {
                if (btn) {
                    // Always remove old listeners to prevent duplicates
                    btn.removeEventListener('click', checkoutViaWhatsApp); 
                    btn.removeEventListener('click', checkoutViaEmail);
                    
                    if (!isCartReady) {
                        btn.style.opacity = '0.7';
                        btn.style.cursor = 'not-allowed';
                    } else {
                        btn.style.opacity = '1';
                        btn.style.cursor = 'pointer';
                        
                        // Add listeners ONLY if the order is ready
                        if (btn.id === 'whatsappCartBtn') {
                            btn.addEventListener('click', checkoutViaWhatsApp);
                        } else if (btn.id === 'emailCartBtn') {
                            btn.addEventListener('click', checkoutViaEmail);
                        }
                    }
                }
            });
        }
        // --- END MODIFIED updateMinimumOrderUI FUNCTION ---


        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 25px;
                right: 25px;
                background-color: var(--secondary);
                color: white;
                padding: 0.8rem 1.2rem;
                border-radius: var(--radius);
                box-shadow: var(--shadow);
                z-index: 3000;
                transform: translateY(100px);
                opacity: 0;
                transition: transform 0.3s ease, opacity 0.3s ease;
                font-weight: 500;
                max-width: 280px;
                text-align: center;
                font-size: 0.9rem;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateY(0)';
                notification.style.opacity = '1';
            }, 10);
            setTimeout(() => {
                notification.style.transform = 'translateY(100px)';
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        function initReviewCarousel() {
            new Swiper('.reviews-carousel .swiper', {
                slidesPerView: 1,
                spaceBetween: 20,
                loop: true,
                autoplay: 
                {
                    delay: 5000,
                    disableOnInteraction: false,
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                breakpoints: {
                    768: {
                        slidesPerView: 2,
                        spaceBetween: 20,
                    },
                    1024: {
                        slidesPerView: 3,
                        spaceBetween: 25,
                    }
                }
            });
        }

        function getRandomProducts(excludeProductId, count = 3) {
            const otherProducts = allProducts.filter(product => product.id !== excludeProductId);
            if (otherProducts.length <= count) {
                return otherProducts;
            }
            
            const shuffled = [...otherProducts];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            return shuffled.slice(0, count);
        }
        
        function generateSimilarProducts() {
            const similarProducts = getRandomProducts(PRODUCT_ID, 3);
            const container = document.getElementById('similarProductsGrid');
            
            container.innerHTML = '';
            
            similarProducts.forEach(product => {
                const discountPercent = Math.round(((product.mrp - product.price) / product.mrp) * 100);
                
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
             
                productCard.setAttribute('itemscope', '');
                productCard.setAttribute('itemtype', 'https://schema.org/Product');
                
                // Create a URL-friendly name for the product page
                const productUrlName = product.name.toLowerCase()
                    .replace(/\s+/g, '-')
                    .replace(/[^\w-]/g, '')
                    .replace(/-+/g, '-');

                productCard.innerHTML = `
                    <div class="product-card-image">
                        <img src="${product.image || 'soap.jpg'}" alt="${product.alt || product.name}" loading="lazy" itemprop="image">
                    </div>
                    <div class="product-card-content">
                        <h3 itemprop="name">${product.name}</h3>
                        <p itemprop="description" style="font-size: 0.85rem;
                        color: #666; margin: 8px 0;
                            line-height: 1.4;">${product.description}</p>
                        <div class="product-card-price-container">
                            <div class="product-card-price">₹${product.price}</div>
                            <div class="product-card-mrp">₹${product.mrp}</div>
                            <div style="font-size: 0.75rem;
                            color: #27ae60; font-weight: 600;
                                background-color: rgba(39, 174, 96, 0.1); padding: 2px 6px;
                                border-radius: 4px;">
                                ${discountPercent}% OFF
                            </div>
                        </div>
                        <a href="product-${productUrlName}.html?id=${product.id}" class="product-card-btn" itemprop="url">
                            <i class="fas fa-shopping-bag"></i> View Details
                        </a>
                    </div>
                `;
                
                container.appendChild(productCard);
            });
        }
        
        // Header Scroll Effect & Menu Toggle
        menuToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            const icon = menuToggle.querySelector('i');
            if (navLinks.classList.contains('active')) {
                icon.classList.remove('fa-bars');
                icon.classList.add('fa-times');
            } else {
                icon.classList.remove('fa-times');
                icon.classList.add('fa-bars');
            }
        });
        navLinks.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                navLinks.classList.remove('active');
                menuToggle.querySelector('i').classList.remove('fa-times');
                menuToggle.querySelector('i').classList.add('fa-bars');
            });
        });

        // --- R2 MODAL AND HISTORY FUNCTIONS (Added for Requirement 2) ---
        
        const getOpenModal = () => {
            if (cartModal && cartModal.classList.contains('open')) return cartModal;
            if (scrubModal && scrubModal.classList.contains('open')) return scrubModal;
            if (emailModal && emailModal.classList.contains('open')) return emailModal;
            return null;
        };

        const closeModal = (modal) => {
            if (modal) {
                modal.classList.remove('open');
                document.body.style.overflow = '';
                // Specific cleanup for email modal
                if (modal.id === 'emailModal') {
                    customerNameInput.value = '';
                    emailProceedBtn.disabled = true;
                }
            }
        };

        const pushModalState = (modalId) => {
             const modalHash = `#${modalId.replace('Modal', '-open')}`;
             if (window.location.hash !== modalHash) {
                history.pushState({ modalOpen: true, modalId: modalId }, '', modalHash);
             }
        };

        const cleanupHash = (modalId) => {
             const modalHash = `#${modalId.replace('Modal', '-open')}`;
             if (window.location.hash === modalHash) {
                 // Replace state to clear the hash without triggering another popstate
                 history.replaceState(null, '', window.location.pathname + window.location.search);
             }
        };

        function setupModalBackNavigation() {
            // Setup Observers to Push History State when a modal opens via function call (e.g., showScrubModal)
            const modals = [cartModal, scrubModal, emailModal].filter(m => m);
            modals.forEach(element => {
                const observer = new MutationObserver((mutationsList) => {
                    mutationsList.forEach(mutation => {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                            if (element.classList.contains('open')) {
                                pushModalState(element.id);
                            } 
                        }
                    });
                });
                observer.observe(element, { attributes: true });
            });

            // 2. Handle the 'popstate' event (browser back button click)
            window.addEventListener('popstate', (e) => {
                const openModal = getOpenModal();
                if (openModal) {
                    // Close the modal and stay on the current page (functional-pack.html).
                    // The history state change has already happened.
                    closeModal(openModal); 
                }
                // If no modal is open, standard browser navigation occurs.
            });
            
            // 3. Re-wire existing open/close listeners to use new functions and manage history cleanup

            // A. Cart Icon Open
            cartIcon.addEventListener('click', () => {
                cartModal.classList.add('open');
                if (window.innerWidth <= 768) {
                    navLinks.classList.remove('active');
                    menuToggle.querySelector('i').classList.remove('fa-times');
                    menuToggle.querySelector('i').classList.add('fa-bars');
                }
            });
            
            // B. Close Cart Button
            closeCart.removeEventListener('click', (e) => { /* original anonymous function */ }); // Remove old listener if it existed
            closeCart.addEventListener('click', () => {
                 closeModal(cartModal);
                 cleanupHash(cartModal.id);
            });

            // C. Scrub Cancel Button
            scrubCancelBtn.removeEventListener('click', (e) => { /* original anonymous function */ });
            scrubCancelBtn.addEventListener('click', () => {
                closeModal(scrubModal);
                cleanupHash(scrubModal.id);
            });

            // D. Scrub Add Button 
            // R2: Adds cleanupHash on successful close
            scrubAddBtn.addEventListener('click', () => {
                // Show loading state
                scrubAddBtn.classList.add('adding');
                scrubAddBtn.innerHTML = '';
                
                setTimeout(() => {
                    // Use the productData and local `quantity` state
                    addToCartWithScrub(PRODUCT_ID, quantity, selectedScrubOption); 

                    closeModal(scrubModal); 
                    cleanupHash(scrubModal.id); // Clean hash on close
                    
                    // Reset button
                    scrubAddBtn.classList.remove('adding');
                    scrubAddBtn.innerHTML = '<i class="fas fa-shopping-bag"></i> Add to Cart';
                }, 800);
            });


            // E. Email Cancel Button
            emailCancelBtn.removeEventListener('click', (e) => { /* original anonymous function */ });
            emailCancelBtn.addEventListener('click', () => {
                closeModal(emailModal);
                cleanupHash(emailModal.id);
            });
            
            // F. Close on outside click
            document.addEventListener('click', (e) => {
                // Cart modal
                if (cartModal.classList.contains('open') && !cartModal.contains(e.target) && !cartIcon.contains(e.target)) {
                    closeModal(cartModal);
                    cleanupHash(cartModal.id);
                }
                
                // Scrub modal
                if (scrubModal.classList.contains('open') && e.target === scrubModal) {
                    closeModal(scrubModal);
                    cleanupHash(scrubModal.id);
                }
                
                // Email modal
                if (emailModal.classList.contains('open') && e.target === emailModal) {
                    closeModal(emailModal);
                    cleanupHash(emailModal.id);
                }
            });
        }
        
        // --- END R2 MODAL AND HISTORY FUNCTIONS ---
        

        function updateHeaderOnScroll() {
            const header = document.querySelector('header');
            if (window.scrollY > 50) {
                header.classList.add('header-scrolled');
            } else {
                header.classList.remove('header-scrolled');
            }
        }

        // Back to Top Button
        const backToTop = document.getElementById('backToTop');
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTop.classList.add('visible');
            } else {
                backToTop.classList.remove('visible');
            }
            updateHeaderOnScroll();
        });
        backToTop.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
        
        // --- New Modal Event Listeners (Kept from original) ---

        // Scrub modal event listeners
        scrubOptions.forEach(option => {
            option.addEventListener('click', function() {
                scrubOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                selectedScrubOption = this.dataset.option;
            });
        });

        // Email modal event listeners (Existing listeners remain, using the modified completeEmailOrder/setupModalBackNavigation)
        customerNameInput.addEventListener('input', function() {
            emailProceedBtn.disabled = this.value.trim() === '';
        });
        customerNameInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && this.value.trim() !== '') {
                completeEmailOrder(this.value.trim());
            }
        });
        
        emailProceedBtn.addEventListener('click', () => {
            completeEmailOrder(customerNameInput.value.trim());
        });
        
        // Initialize everything
        document.addEventListener('DOMContentLoaded', () => {
            loadCartFromStorage();
            initSlideshow();
            updatePriceDisplay();
            generateSimilarProducts();
            initReviewCarousel();
            setupModalBackNavigation(); // R2: Initialize back button logic

            window.addEventListener('storage', function(e) {
             
                if (e.key === 'cartUpdated') {
                    loadCartFromStorage();
                }
            });
            
            document.documentElement.style.overflowX = 'hidden';
            document.body.style.overflowX = 'hidden';
     
            updateHeaderOnScroll();
        });
    </script>
</body>

</html>
